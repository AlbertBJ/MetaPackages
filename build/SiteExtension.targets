<Project>

  <Target Name="BuildSiteExtension">
    <Error Text="Please specify fallback archive zip file localtion via FallbackArchive parameter." Condition="'$(FallbackArchive)' == ''"/>
    <Error Text="Please specify runtime store zip file location localtion via RuntimeStore parameter." Condition="'$(RuntimeStore)' == ''"/>

    <GetDotNetHost>
      <Output TaskParameter="DotNetDirectory" PropertyName="DotnetHomeDirectory" />
    </GetDotNetHost>

    <PropertyGroup>
      <FallbackArchiveDestination>$(TempDir)FallbackArchive</FallbackArchiveDestination>
      <RuntimeStoreDestination>$(TempDir)RuntimeStore</RuntimeStoreDestination>
    </PropertyGroup>

    <UnzipArchive File="$(FallbackArchive)" Destination="$(FallbackArchiveDestination)" Overwrite="true" />
    <UnzipArchive File="$(RuntimeStore)" Destination="$(RuntimeStoreDestination)" Overwrite="true" />

    <MSBuild Projects="$(RepositoryRoot)src\Microsoft.AspNetCore.SiteExtension\Microsoft.AspNetCore.SiteExtension.csproj"
      Targets="Pack"
      Properties="DotnetHomeDirectory=$(DotnetHomeDirectory);FallbackArchiveDestination=$(FallbackArchiveDestination);RuntimeStoreDestination=$(RuntimeStoreDestination)" />
  </Target>

</Project>