<Project>

  <Target Name="BuildSiteExtension">
    <Error Text="Please specify fallback archive zip file localtion via FallbackArchive parameter." Condition="'$(FallbackArchive)' == ''"/>
    <Error Text="Please specify runtime cache zip file location localtion via RuntimeCache parameter." Condition="'$(RuntimeCache)' == ''"/>

    <GetDotNetHost>
      <Output TaskParameter="DotNetDirectory" PropertyName="DotnetHomeDirectory" />
    </GetDotNetHost>

    <PropertyGroup>
      <FallbackArchiveDestination>$(TempDir)FallbackArchive</FallbackArchiveDestination>
      <RuntimeCacheDestination>$(TempDir)RuntimeCache</RuntimeCacheDestination>
    </PropertyGroup>

    <UnzipArchive File="$(FallbackArchive)" Destination="$(FallbackArchiveDestination)" Overwrite="true" />
    <UnzipArchive File="$(RuntimeCache)" Destination="$(RuntimeCacheDestination)" Overwrite="true" />

    <MSBuild Projects="$(RepositoryRoot)src\Microsoft.AspNetCore.SiteExtension\Microsoft.AspNetCore.SiteExtension.csproj"
      Targets="Pack"
      Properties="DotnetHomeDirectory=$(DotnetHomeDirectory);FallbackArchiveDestination=$(FallbackArchiveDestination);RuntimeCacheDestination=$(RuntimeCacheDestination)" />
  </Target>

<Project>